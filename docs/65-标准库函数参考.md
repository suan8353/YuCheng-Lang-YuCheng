# 御程标准库函数

## 概述

御程标准库 (`stdlib.rs`) 提供 200+ 内置函数，按功能分类如下：

```rust
pub struct Stdlib {
    functions: HashMap<String, (StdlibFn, FunctionCategory)>,
}

pub enum FunctionCategory {
    Pure,   // 纯函数 - 无副作用
    Query,  // 查询 - 可读外部状态
    Effect, // 副作用 - 可修改状态
}
```

## 核心函数

### 输入输出

| 函数 | 英文别名 | 分类 | 签名 | 说明 |
|------|----------|------|------|------|
| `打印` | `print` | Effect | `(...args) -> 空` | 输出到控制台 |
| `输入` | `input` | Effect | `(提示?: 文本) -> 文本` | 读取用户输入 |

### 日志函数

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `追踪` | `trace` | Effect | `[追踪] 前缀输出` |
| `调试` | `debug` | Effect | `[调试] 前缀输出` |
| `信息` | `info` | Effect | `[信息] 前缀输出` |
| `警告` | `warn` | Effect | `[警告] 前缀输出` |
| `错误日志` | `error_log` | Effect | `[错误] 前缀输出到 stderr` |

### 类型转换

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `转整数` | `to_int` | Pure | `(值: 任意) -> 整数` |
| `转小数` | `to_float` | Pure | `(值: 任意) -> 小数` |
| `转文本` | `to_string` | Pure | `(值: 任意) -> 文本` |
| `获取类型` | `type_of` | Pure | `(值: 任意) -> 文本` |

## 数学函数

| 函数 | 英文别名 | 分类 | 签名 | 说明 |
|------|----------|------|------|------|
| `绝对值` | `abs` | Pure | `(n: 数值) -> 数值` | 返回绝对值 |
| `四舍五入` | `round` | Pure | `(n: 小数) -> 整数` | 四舍五入 |
| `向下取整` | `floor` | Pure | `(n: 小数) -> 整数` | 向下取整 |
| `向上取整` | `ceil` | Pure | `(n: 小数) -> 整数` | 向上取整 |
| `最大值` | `max` | Pure | `(a: 数值, b: 数值) -> 数值` | 返回较大值 |
| `最小值` | `min` | Pure | `(a: 数值, b: 数值) -> 数值` | 返回较小值 |
| `幂` | `pow` | Pure | `(底数: 数值, 指数: 数值) -> 数值` | 幂运算 |
| `平方根` | `sqrt` | Pure | `(n: 数值) -> 小数` | 平方根 |
| `随机整数` | `random_int` | Effect | `(最小: 整数, 最大: 整数) -> 整数` | 随机数 |

## 文本函数

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `文本长度` | `str_len` | Pure | `(s: 文本) -> 整数` |
| `文本拼接` | `str_concat` | Pure | `(a: 文本, b: 文本) -> 文本` |
| `文本截取` | `str_slice` | Pure | `(s: 文本, 开始: 整数, 结束: 整数) -> 文本` |
| `文本替换` | `str_replace` | Pure | `(s: 文本, 旧: 文本, 新: 文本) -> 文本` |
| `文本包含` | `str_contains` | Query | `(s: 文本, 子串: 文本) -> 布尔` |
| `文本分割` | `str_split` | Pure | `(s: 文本, 分隔符: 文本) -> 列表<文本>` |
| `去除空白` | `str_trim` | Pure | `(s: 文本) -> 文本` |
| `转大写` | `str_upper` | Pure | `(s: 文本) -> 文本` |
| `转小写` | `str_lower` | Pure | `(s: 文本) -> 文本` |
| `文本连接` | `str_join` | Pure | `(列表: 列表<文本>, 分隔符: 文本) -> 文本` |

## 列表函数

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `列表长度` | `list_len` | Pure | `(列表: 列表<T>) -> 整数` |
| `长度` | `length` | Pure | `(集合: 任意) -> 整数` |
| `列表添加` | `list_push` | Pure | `(列表: 列表<T>, 元素: T) -> 列表<T>` |
| `列表获取` | `list_get` | Query | `(列表: 列表<T>, 索引: 整数) -> T?` |
| `列表设置` | `list_set` | Pure | `(列表: 列表<T>, 索引: 整数, 值: T) -> 列表<T>` |
| `列表连接` | `list_concat` | Pure | `(a: 列表<T>, b: 列表<T>) -> 列表<T>` |
| `列表反转` | `list_reverse` | Pure | `(列表: 列表<T>) -> 列表<T>` |
| `列表包含` | `list_contains` | Query | `(列表: 列表<T>, 元素: T) -> 布尔` |
| `列表查找` | `list_find` | Query | `(列表: 列表<T>, 元素: T) -> 整数?` |
| `首元素` | `first` | Query | `(列表: 列表<T>) -> T?` |
| `末元素` | `last` | Query | `(列表: 列表<T>) -> T?` |
| `切片` | `slice` | Pure | `(列表: 列表<T>, 开始: 整数, 结束: 整数) -> 列表<T>` |
| `范围` | `range` | Pure | `(开始: 整数, 结束: 整数) -> 列表<整数>` |

## 空值检查

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `是空` | `is_null` | Query | `(值: 任意) -> 布尔` |
| `非空` | `is_not_null` | Query | `(值: 任意) -> 布尔` |

## Result类型函数（方案C：关键字改为函数）

**重要变更**：从v0.2开始，`成功`、`失败`、`返回值`、`任务`、`输入` 不再是关键字，而是标准库函数。这降低了学习难度，减少了命名冲突。

### 构造函数

| 函数 | 英文别名 | 分类 | 签名 | 说明 |
|------|----------|------|------|------|
| `成功` | `ok` | Pure | `(值: T) -> Result<T>` | 创建成功的Result |
| `失败` | `err` | Pure | `(错误: E) -> Result<E>` | 创建失败的Result |

**实现细节**：Result类型是一个映射，包含：
- 成功：`{ 类型: "成功", 值: T }`
- 失败：`{ 类型: "失败", 错误: E }`

### 检查函数

| 函数 | 英文别名 | 分类 | 签名 | 说明 |
|------|----------|------|------|------|
| `是成功` | `is_ok` | Query | `(result: Result) -> 布尔` | 检查是否为成功 |
| `是失败` | `is_err` | Query | `(result: Result) -> 布尔` | 检查是否为失败 |

### 解包函数

| 函数 | 英文别名 | 分类 | 签名 | 说明 |
|------|----------|------|------|------|
| `解包` | `unwrap` | Pure | `(result: Result<T>) -> T` | 解包成功值，失败时panic |
| `解包或` | `unwrap_or` | Pure | `(result: Result<T>, 默认: T) -> T` | 解包或返回默认值 |
| `期望` | `expect` | Pure | `(result: Result<T>, 消息: 文本) -> T` | 解包并显示自定义错误 |

### 转换函数

| 函数 | 英文别名 | 分类 | 签名 | 说明 |
|------|----------|------|------|------|
| `映射` | `map` | Pure | `(result: Result<T>, fn) -> Result<U>` | 映射成功值（简化实现） |
| `映射错误` | `map_err` | Pure | `(result: Result<T>, fn) -> Result<T>` | 映射错误值（简化实现） |

### 使用示例

```yucheng
// 创建Result
var 成功结果 = 成功(42)
var 失败结果 = 失败("错误信息")

// 检查Result
如果 是成功(成功结果) {
    var 值 = 解包(成功结果)
    控制台 => "值:", 值
}

// 安全解包
var 值 = 解包或(失败结果, 0)  // 返回0

// 期望特定值
var 值 = 期望(成功结果, "应该成功")  // 失败时显示消息

// 函数返回Result
纯函数 func 安全除法(a: 整数, b: 整数) -> Result {
    如果 b == 0 {
        返回 失败("除数不能为零")
    }
    返回 成功(a / b)
}

// 使用Result
var 结果 = 安全除法(10, 2)
如果 是成功(结果) {
    控制台 => "结果:", 解包(结果)
} 否则 {
    控制台 => "计算失败"
}
```

### 迁移指南

**旧语法（v0.1）**：
```yucheng
// 使用关键字
匹配 结果 {
    成功(值) => 处理(值)
    失败(错误) => 记录(错误)
}
```

**新语法（v0.2+）**：
```yucheng
// 使用函数
如果 是成功(结果) {
    var 值 = 解包(结果)
    处理(值)
} 否则 {
    控制台 => "操作失败"
}
```

**优势**：
- ✅ 减少关键字数量（~40 → ~35）
- ✅ "成功"、"失败"、"任务" 等常用词可作为变量名
- ✅ 更符合主流语言习惯（Result作为库类型）
- ✅ 降低学习难度
- ✅ 保持功能完整性

## 断言函数

### 基础断言

| 函数 | 英文别名 | 说明 |
|------|----------|------|
| `断言_相等` | `assert_equal` | 断言两值相等 |
| `断言_不等` | `assert_not_equal` | 断言两值不等 |
| `断言_为真` | `assert_true` | 断言条件为真 |
| `断言_为假` | `assert_false` | 断言条件为假 |
| `断言_为空` | `assert_null` | 断言值为空 |
| `断言_非空` | `assert_not_null` | 断言值非空 |
| `断言_大于` | `assert_greater` | 断言 a > b |
| `断言_小于` | `assert_less` | 断言 a < b |
| `断言_范围内` | `assert_in_range` | 断言值在范围内 |
| `断言_近似相等` | `assert_approx_equal` | 浮点数近似相等 |

### 集合断言

| 函数 | 英文别名 | 说明 |
|------|----------|------|
| `断言_包含` | `assert_contains` | 断言集合包含元素 |
| `断言_不包含` | `assert_not_contains` | 断言集合不包含元素 |
| `断言_长度` | `assert_length` | 断言集合长度 |
| `断言_为空集合` | `assert_empty` | 断言集合为空 |
| `断言_非空集合` | `assert_not_empty` | 断言集合非空 |
| `断言_有序` | `assert_sorted` | 断言列表有序 |
| `断言_唯一` | `assert_unique` | 断言元素唯一 |
| `断言_子集` | `assert_subset` | 断言是子集 |

### 御程独有断言

| 函数 | 英文别名 | 说明 |
|------|----------|------|
| `断言_成功` | `assert_ok` | 断言结果为成功 |
| `断言_失败` | `assert_err` | 断言结果为失败 |
| `断言_成功值` | `assert_ok_value` | 断言成功值等于期望 |
| `断言_失败值` | `assert_err_value` | 断言失败值等于期望 |
| `断言_匹配` | `assert_match` | 模式匹配断言 |
| `断言_全部成功` | `assert_all_ok` | 断言所有结果成功 |
| `断言_任一成功` | `assert_any_ok` | 断言至少一个成功 |
| `断言_变换` | `assert_transform` | 管道变换断言 |
| `断言_深度相等` | `assert_deep_equal` | 深度比较 |

### 性能断言

| 函数 | 英文别名 | 说明 |
|------|----------|------|
| `断言_耗时` | `assert_duration` | 断言执行时间 |
| `断言_内存` | `assert_memory` | 断言内存使用 |
| `断言_无泄漏` | `assert_no_leak` | 断言无内存泄漏 |

### 函数特性断言

| 函数 | 英文别名 | 说明 |
|------|----------|------|
| `断言_纯函数` | `assert_pure` | 断言函数是纯函数 |
| `断言_幂等` | `assert_idempotent` | 断言函数幂等 |
| `断言_无副作用` | `assert_no_side_effect` | 断言无副作用 |

## 系统 API

### 文件系统

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `读取文件` | `read_file` | Effect | `(路径: 文本) -> 结果<文本, 错误>` |
| `写入文件` | `write_file` | Effect | `(路径: 文本, 内容: 文本) -> 结果<空, 错误>` |
| `追加文件` | `append_file` | Effect | `(路径: 文本, 内容: 文本) -> 结果<空, 错误>` |
| `删除文件` | `delete_file` | Effect | `(路径: 文本) -> 结果<空, 错误>` |
| `文件存在` | `file_exists` | Query | `(路径: 文本) -> 布尔` |
| `列出目录` | `list_dir` | Query | `(路径: 文本) -> 列表<文本>` |
| `创建目录` | `create_dir` | Effect | `(路径: 文本) -> 结果<空, 错误>` |
| `删除目录` | `remove_dir` | Effect | `(路径: 文本) -> 结果<空, 错误>` |
| `获取文件大小` | `file_size` | Query | `(路径: 文本) -> 整数` |
| `是目录` | `is_dir` | Query | `(路径: 文本) -> 布尔` |
| `是文件` | `is_file` | Query | `(路径: 文本) -> 布尔` |

### 环境与进程

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `获取环境变量` | `get_env` | Query | `(名称: 文本) -> 文本?` |
| `设置环境变量` | `set_env` | Effect | `(名称: 文本, 值: 文本) -> 空` |
| `获取当前目录` | `get_cwd` | Query | `() -> 文本` |
| `执行命令` | `exec` | Effect | `(命令: 文本) -> 整数` |
| `执行命令获取输出` | `exec_output` | Effect | `(命令: 文本) -> 文本` |
| `获取进程ID` | `get_pid` | Query | `() -> 整数` |
| `获取命令行参数` | `get_args` | Query | `() -> 列表<文本>` |

### 时间与日期

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `当前时间戳` | `timestamp` | Query | `() -> 整数` |
| `当前日期时间` | `datetime` | Query | `() -> 文本` |
| `休眠` | `sleep` | Effect | `(毫秒: 整数) -> 空` |

### 系统信息

| 函数 | 英文别名 | 分类 | 返回值 |
|------|----------|------|--------|
| `获取操作系统` | `get_os` | Query | `"windows"/"linux"/"macos"` |
| `获取CPU架构` | `get_arch` | Query | `"x86_64"/"aarch64"` |
| `获取主机名` | `get_hostname` | Query | 主机名 |
| `获取用户名` | `get_username` | Query | 当前用户名 |
| `获取主目录` | `get_home` | Query | 用户主目录路径 |
| `获取临时目录` | `get_temp_dir` | Query | 临时目录路径 |

### 网络

| 函数 | 英文别名 | 分类 | 签名 |
|------|----------|------|------|
| `HTTP获取` | `http_get` | Effect | `(url: 文本) -> 结果<文本, 错误>` |

## 多语言互操作

### Python 互操作

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `Python调用` | `python_call` | Effect | 调用 Python 函数 |
| `Python执行` | `python_exec` | Effect | 执行 Python 代码 |
| `Python可用` | `python_available` | Query | 检查 Python 是否可用 |

### JavaScript 互操作

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `JS调用` | `js_call` | Effect | 调用 JavaScript 函数 |
| `JS执行` | `js_exec` | Effect | 执行 JavaScript 代码 |
| `JS可用` | `js_available` | Query | 检查 Node.js 是否可用 |

## 移动端 API

### 平台信息

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `获取平台` | `get_platform` | Query | 返回 `"ios"/"android"/"desktop"` |
| `是移动端` | `is_mobile` | Query | 是否在移动设备上运行 |

### 权限管理

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `请求权限` | `request_permission` | Effect | 请求系统权限 |
| `检查权限` | `check_permission` | Query | 检查权限状态 |

### 设备功能

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `获取位置` | `get_location` | Effect | 获取 GPS 位置 |
| `显示通知` | `show_notification` | Effect | 显示系统通知 |
| `显示提示` | `show_toast` | Effect | 显示 Toast 提示 |
| `振动` | `vibrate` | Effect | 设备振动 |
| `获取设备信息` | `get_device_info` | Query | 获取设备信息 |
| `获取网络状态` | `get_network_status` | Query | 获取网络连接状态 |
| `打开链接` | `open_url` | Effect | 打开外部链接 |
| `分享文本` | `share_text` | Effect | 调用系统分享 |

### 剪贴板

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `复制到剪贴板` | `copy_to_clipboard` | Effect | 复制文本到剪贴板 |
| `读取剪贴板` | `read_clipboard` | Query | 读取剪贴板内容 |

### 相机与图片

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `拍照` | `take_photo` | Effect | 调用相机拍照 |
| `选择图片` | `pick_image` | Effect | 从相册选择图片 |
| `扫描二维码` | `scan_qrcode` | Effect | 扫描二维码 |

### 生物识别

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `生物识别认证` | `authenticate_biometric` | Effect | 指纹/面容认证 |

## 异步函数

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `等待_全部` | `await_all` | Effect | 等待所有 Promise 完成 |
| `等待_任一` | `await_any` | Effect | 等待任一 Promise 完成 |
| `等待_超时` | `await_timeout` | Effect | 带超时的等待 |
| `延迟` | `delay` | Effect | 延迟执行 |

## 内存管理函数

### 手动内存管理

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `分配` | `allocate` | Effect | 分配内存 |
| `释放` | `free` | Effect | 释放内存 |
| `重新分配` | `reallocate` | Effect | 重新分配内存 |
| `复制内存` | `copy_memory` | Effect | 复制内存块 |
| `清零` | `zero_memory` | Effect | 内存清零 |

### 智能指针

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `智能指针` | `smart_ptr` | Pure | 创建智能指针 |
| `引用计数` | `ref_count` | Query | 获取引用计数 |
| `弱引用` | `weak_ref` | Pure | 创建弱引用 |

### 指针工具

| 函数 | 英文别名 | 分类 | 说明 |
|------|----------|------|------|
| `是空指针` | `is_null_ptr` | Query | 检查是否为空指针 |
| `指针偏移` | `ptr_offset` | Pure | 指针偏移计算 |
| `指针相等` | `ptr_equal` | Query | 比较两个指针 |
