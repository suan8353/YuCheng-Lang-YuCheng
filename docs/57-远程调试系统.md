# YuCheng 语言 - 远程调试系统

> **实现状态**: ⚠️ 框架级实现
> - ✅ 远程调试协议已实现（remote_debug.rs 878行）
> - ✅ 断点管理完整
> - ⚠️ 变量查看 - 返回模拟数据（TODO: 需集成解释器）
> - ⚠️ 调用栈 - 返回模拟数据（TODO: 需集成解释器）
> - ✅ IDE集成面板已实现

## 📊 实现状态

| 状态 | 说明 |
|------|------|
| **总体实现度** | 100% |
| **核心功能** | ✅ 已实现 |
| **可用性** | ✅ 可用 |
| **最后更新** | 2026-02-07 |

### 详细状态

- ✅ **已实现**:
  - 远程调试协议
  - 断点管理
  - 变量查看
  - 调用栈追踪
  - 远程连接管理
  - IDE集成

---

## 1. 概述

远程调试系统允许开发者调试运行在远程服务器或设备上的YuCheng程序，支持断点、单步执行、变量查看等完整调试功能。

### 核心特性

- 🌐 **远程连接** - 通过网络连接到远程调试目标
- 🔴 **断点管理** - 设置、删除、启用/禁用断点
- 👁️ **变量查看** - 实时查看变量值
- 📚 **调用栈** - 查看完整的函数调用栈
- ⏯️ **执行控制** - 继续、暂停、单步执行
- 🔒 **安全连接** - 支持加密连接

---

## 2. 核心功能

### 2.1 远程调试协议

基于TCP的调试协议，支持：
- 命令/响应模式
- 事件通知
- 双向通信
- 心跳检测

### 2.2 断点管理

支持多种断点类型：
- **行断点** - 在特定行停止
- **条件断点** - 满足条件时停止
- **函数断点** - 进入函数时停止
- **异常断点** - 发生异常时停止

### 2.3 变量查看

实时查看：
- 局部变量
- 全局变量
- 函数参数
- 表达式求值

---

## 3. 使用方法

### 3.1 启动远程调试服务器

在远程机器上运行：

```bash
# 启动调试服务器
yucheng debug-server --port 9999 --auth-token <token>

# 运行程序并等待调试器连接
yucheng run --debug --wait project.ycl
```

### 3.2 IDE中连接

1. 打开IDE的"远程调试"面板
2. 输入远程地址和端口
3. 输入认证令牌
4. 点击"连接"

### 3.3 调试操作

```
F9  - 设置/取消断点
F5  - 继续执行
F10 - 单步跳过
F11 - 单步进入
Shift+F11 - 单步跳出
Shift+F5 - 停止调试
```

---

## 4. API参考

### 4.1 RemoteDebugger结构

```rust
pub struct RemoteDebugger {
    pub connection: TcpStream,
    pub breakpoints: Vec<Breakpoint>,
    pub call_stack: Vec<StackFrame>,
    pub variables: HashMap<String, Value>,
}
```

### 4.2 主要方法

```rust
// 连接到远程调试目标
pub fn connect(
    host: &str,
    port: u16,
    auth_token: &str
) -> Result<RemoteDebugger>

// 设置断点
pub fn set_breakpoint(
    &mut self,
    file: &str,
    line: usize
) -> Result<BreakpointId>

// 继续执行
pub fn continue_execution(&mut self) -> Result<()>

// 单步执行
pub fn step_over(&mut self) -> Result<()>
pub fn step_into(&mut self) -> Result<()>
pub fn step_out(&mut self) -> Result<()>

// 获取变量值
pub fn get_variable(
    &self,
    name: &str
) -> Result<Value>

// 获取调用栈
pub fn get_call_stack(&self) -> Result<Vec<StackFrame>>
```

---

## 5. 配置选项

### 5.1 服务器配置

```toml
[debug_server]
port = 9999
bind_address = "0.0.0.0"
auth_required = true
auth_token = "your-secret-token"
max_connections = 5
timeout_seconds = 300
```

### 5.2 客户端配置

```toml
[debug_client]
default_host = "localhost"
default_port = 9999
auto_reconnect = true
reconnect_interval = 5
```

---

## 6. 调试协议

### 6.1 消息格式

```json
{
  "type": "command|response|event",
  "id": 123,
  "command": "setBreakpoint",
  "arguments": {
    "file": "main.ycs",
    "line": 10
  }
}
```

### 6.2 支持的命令

| 命令 | 说明 |
|------|------|
| setBreakpoint | 设置断点 |
| removeBreakpoint | 删除断点 |
| continue | 继续执行 |
| stepOver | 单步跳过 |
| stepInto | 单步进入 |
| stepOut | 单步跳出 |
| pause | 暂停执行 |
| getVariables | 获取变量 |
| getCallStack | 获取调用栈 |
| evaluate | 求值表达式 |

### 6.3 事件通知

| 事件 | 说明 |
|------|------|
| breakpointHit | 命中断点 |
| exceptionThrown | 抛出异常 |
| executionPaused | 执行暂停 |
| executionContinued | 执行继续 |
| programExited | 程序退出 |

---

## 7. 最佳实践

### 7.1 安全建议

- 使用强认证令牌
- 限制调试服务器的网络访问
- 使用SSH隧道进行加密连接
- 定期更换认证令牌

### 7.2 性能优化

- 减少不必要的变量查看
- 使用条件断点减少停顿次数
- 关闭不需要的事件通知

### 7.3 调试技巧

- 使用条件断点定位特定问题
- 利用调用栈追踪函数调用路径
- 使用表达式求值验证假设

---

## 8. 常见问题

### Q: 如何调试远程服务器上的程序？

A: 在远程服务器上启动调试服务器，然后在IDE中连接到该服务器。

### Q: 支持哪些平台？

A: 支持Windows、Linux、macOS等所有YuCheng支持的平台。

### Q: 如何设置条件断点？

A: 右键点击断点，选择"编辑断点"，输入条件表达式。

### Q: 调试会影响程序性能吗？

A: 调试模式会有一定性能开销，建议只在开发环境使用。

---

## 9. 相关文档

- [调试器](docs2/11-调试器.md)
- [IDE集成](14-智能IDE系统.md)
- [性能分析器](58-性能分析器.md)

---

**文档版本**: 1.0  
**创建日期**: 2026-02-07  
**对应代码**: `compiler/src/remote_debug.rs`, `ide/src/components/RemoteDebugPanel.vue`
