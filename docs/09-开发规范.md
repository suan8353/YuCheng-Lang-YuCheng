# YuCheng 语言 - 开发规范

## 1. 文件命名规范

### 1.1 扩展名使用

| 扩展名 | 用途 | 必须 |
|-------|------|------|
| `.yc` | 规格定义 | ✓ |
| `.yci` | 逻辑实现 | ✓ |
| `.ycl` | 链接配置 | ✓ |
| `.ycv` | 界面视图 | 可选 |
| `.ycs` | 单文件模式 | 可选（教学/原型） |

### 1.2 文件命名

```
// ✅ 推荐
user.yc / user.yci
order_manager.yc / order_manager.yci
login.ycv

// ❌ 避免
User.yc          // 不要大写开头
user-manager.yc  // 不要用连字符
```

## 2. 变量命名规范

```御程
// ✅ 推荐：有意义的中文名
var 用户名
var 登录状态
var 购物车列表

// ✅ 推荐：拼音（当中文不便时）
var nianling
var shouji

// ❌ 避免：无意义的名称
var a
var temp1
var x
```

## 3. 函数声明规范

```御程
// 必须使用分类关键字声明（编译器强制检查）

// 纯函数：无副作用，可缓存
纯函数 func 总价(单价: 小数, 数量: 整数) -> 小数
纯函数 func 折扣金额(原价: 小数, 折扣率: 小数) -> 小数

// 查询函数：只读，不修改状态
查询 func 用户信息(用户ID: 整数) -> 用户
查询 func 当前时间() -> 时间戳

// 副作用函数：可修改状态、执行I/O
副作用 func 保存用户(用户数据: 用户)
副作用 func 发送邮件(收件人: 文本, 内容: 文本)

// ❌ 编译错误：缺少分类关键字
func 保存用户()      // 错误：必须声明为 副作用 func
func 用户信息()      // 错误：必须声明为 查询 func

// 可选：添加契约声明
纯函数 func 平方根(x: 小数) -> 小数
    要求 x >= 0.0
    保证 返回值 >= 0.0
```

## 4. 代码格式

### 4.1 缩进

```御程
// ✅ 使用 4 个空格
如果 条件 {
    操作1()
    如果 子条件 {
        操作2()
    }
}
```

### 4.2 空行

```御程
// 函数之间空一行
纯函数 func 加法(a: 整数, b: 整数) -> 整数 {
    返回 a + b
}

纯函数 func 减法(a: 整数, b: 整数) -> 整数 {
    返回 a - b
}

// 逻辑块之间空一行
副作用 func 处理订单(订单: 订单) {
    // 验证订单
    如果 !验证订单(订单) {
        返回
    }
    
    // 计算价格
    var 总价 = 计算订单总价(订单)
    
    // 保存订单
    保存订单(订单)
}
```

### 4.3 空格

```御程
// 运算符两侧加空格
var 结果 = a + b
var 条件 = x > 0 && y < 100

// 逗号后加空格
函数(参数1, 参数2, 参数3)
```

## 5. 注释规范

### 5.1 文件头注释

```御程
/*
 * 文件名: user_manager.yci
 * 描述: 用户管理模块
 * 作者: 张三
 * 创建日期: 2026-01-10
 */
```

### 5.2 函数注释

```御程
/*
 * 计算订单总价
 * 
 * 参数:
 *   订单 - 订单对象
 *   使用优惠券 - 是否使用优惠券
 * 
 * 返回:
 *   总价 - 计算后的订单总价
 */
纯函数 func 订单总价(订单: 订单, 使用优惠券: 布尔) -> 小数 {
    // 实现...
}
```

### 5.3 行内注释

```御程
// ✅ 解释"为什么"
var 折扣率 = 0.8  // 会员享受8折优惠

// ❌ 避免显而易见的注释
计数 = 计数 + 1  // 计数加1
```

## 6. 目录结构

```
project/
├── src/                    # 源代码
│   ├── core/
│   │   ├── core.yc
│   │   └── core.yci
│   ├── user/
│   │   ├── user.yc
│   │   ├── user.yci
│   │   └── user.ycv
│   └── order/
│       ├── order.yc
│       └── order.yci
├── tests/                  # 测试代码
│   ├── test_user.yc
│   └── test_user.yci
├── assets/                 # 资源文件
├── project.ycl            # 项目链接配置
└── README.md
```

## 7. 函数设计规范

### 7.1 单一职责

```御程
// ✅ 每个函数只做一件事
副作用 func 验证用户名(用户名: 文本) -> 布尔
副作用 func 验证密码(密码: 文本) -> 布尔
副作用 func 创建用户(用户名: 文本, 密码: 文本) -> 用户

// ❌ 一个函数做太多事
副作用 func 验证并创建用户(用户名: 文本, 密码: 文本) -> 用户
```

### 7.2 参数数量

```御程
// ✅ 参数不超过 4 个
副作用 func 创建订单(用户ID: 整数, 商品列表: 列表<商品>, 地址: 地址) -> 订单

// ✅ 参数过多时使用对象
副作用 func 创建订单(订单参数: 订单参数) -> 订单
```

### 7.3 函数长度

```御程
// ✅ 函数不超过 30 行
// 超过时拆分为多个小函数
```

### 7.4 契约声明

```御程
// ✅ 为关键函数添加契约
纯函数 func 平方根(x: 小数) -> 小数
    要求 x >= 0.0
    保证 返回值 >= 0.0

纯函数 func 除法(a: 小数, b: 小数) -> 小数
    要求 b <> 0.0
```

## 8. 错误处理规范

```御程
// ✅ 使用尝试-捕获
副作用 func 读取配置() {
    尝试 {
        var 内容 = 读取文件("config.json")
        var 配置 = JSON解析(内容)
    } 捕获 错误 {
        打印("配置读取失败：", 错误.信息)
        配置 = 默认配置
    }
}

// ✅ 使用 最终 确保清理
尝试 {
    var 文件 = 打开文件(路径)
    // 处理...
} 最终 {
    如果 文件 <> 空 {
        关闭文件(文件)
    }
}
```

## 9. 内存管理规范

```御程
// ✅ 默认使用作用域绑定（自动释放）
{
    var buf = 申请(1024)
    // ... 使用 buf ...
} // 离开作用域自动释放

// ✅ 需要延长生命周期时使用 持有/释放
var p = 持有(buf)
// ... 使用 p ...
释放(p)  // 必须手动释放

// ✅ 释放后置空 (防止悬垂指针)
释放(指针)
指针 = 空

// ✅ 使用前检查空指针
如果 指针 <> 空 {
    var 值 = *指针
}
```

## 10. 测试规范

```御程
// ✅ 使用断言，不用打印
测试 "加法测试" {
    断言_相等(加法(2, 3), 5)
}

// ❌ 表演测试
测试 "加法测试" {
    打印(加法(2, 3))  // 只打印不验证
}
```

## 11. 版本控制

### 提交信息格式

```
<类型>: <简短描述>

类型:
- 功能: 新功能
- 修复: Bug 修复
- 文档: 文档更新
- 重构: 代码重构
- 测试: 测试相关
```

### 分支命名

```
main              # 主分支
develop           # 开发分支
feature/登录功能   # 功能分支
bugfix/修复登录    # 修复分支
```

## 12. 代码审查清单

- [ ] 函数是否使用了正确的分类关键字（纯函数/查询/副作用）
- [ ] 关键函数是否添加了契约声明（要求/保证）
- [ ] 类型转换是否显式声明
- [ ] 命名是否清晰、符合规范
- [ ] 是否有适当的注释
- [ ] 是否处理了错误情况
- [ ] 内存是否正确管理（持有/释放成对）
- [ ] 测试是否使用了断言
- [ ] 代码格式是否一致
