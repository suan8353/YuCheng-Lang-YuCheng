# YuCheng 语言 - 界面系统详解

> **实现状态**: ✅ 完整实现
> - ✅ UI解析器完整（.ycv文件解析）
> - ✅ 响应式系统完整（1000+行代码）
> - ✅ 双向绑定完整实现
> - ✅ 完整的响应式更新机制
> - ✅ 批量更新优化
> - ✅ 防抖节流支持
> - ✅ 计算属性自动失效
> - ✅ 依赖追踪系统

## 1. 混合式界面架构

YuCheng 采用"声明式定义 + 代码式逻辑"的混合模式。

```
┌─────────────────────────────────────────────────────────┐
│                    界面系统架构                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│   .ycv 文件 (声明式)         .yci 文件 (代码式)          │
│   ┌─────────────────┐       ┌─────────────────┐        │
│   │  界面结构定义     │       │  事件处理逻辑    │        │
│   │  控件属性设置     │◄─────▶│  数据绑定更新    │        │
│   │  布局排列方式     │       │  业务逻辑调用    │        │
│   └─────────────────┘       └─────────────────┘        │
│            │                         │                  │
│            └────────────┬────────────┘                  │
│                         ▼                               │
│              ┌─────────────────┐                        │
│              │   渲染引擎       │                        │
│              └─────────────────┘                        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 2. 视图文件语法 (.ycv)

### 2.1 基本结构

```御程
// main.ycv

窗口 主窗口 {
    标题: "我的应用"
    宽度: 800
    高度: 600
    可调整: 真
    
    布局_垂直 {
        // 子控件
    }
}
```

### 2.2 窗口属性

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `标题` | 文本 | "YuCheng应用" | 窗口标题 |
| `宽度` | 整数 | 800 | 窗口宽度 |
| `高度` | 整数 | 600 | 窗口高度 |
| `可调整` | 布尔 | 真 | 是否可调整大小 |
| `居中` | 布尔 | 真 | 是否居中显示 |
| `图标` | 文本 | 空 | 图标路径 |

## 3. 布局系统

### 3.1 垂直布局

```御程
布局_垂直 {
    间距: 10
    内边距: 20
    对齐: "居中"
    
    文本标签 { 内容: "第一行" }
    文本标签 { 内容: "第二行" }
}
```

### 3.2 水平布局

```御程
布局_水平 {
    间距: 10
    对齐: "居中"
    
    按钮 { 文字: "按钮1" }
    按钮 { 文字: "按钮2" }
}
```

### 3.3 网格布局

```御程
布局_网格 {
    列数: 3
    行数: 2
    间距: 10
    
    按钮 { 文字: "1" }
    按钮 { 文字: "2" }
    按钮 { 文字: "3" }
    按钮 { 文字: "4" }
    按钮 { 文字: "5" }
    按钮 { 文字: "6" }
}
```

## 4. 基础控件

### 4.1 文本标签

```御程
文本标签 欢迎语 {
    内容: "欢迎使用 YuCheng"
    字体大小: 24
    字体颜色: "#333333"
    字体粗细: "粗体"
    对齐: "居中"
}
```

### 4.2 按钮

```御程
按钮 提交按钮 {
    文字: "提交"
    宽度: 120
    高度: 40
    背景色: "#4CAF50"
    文字颜色: "#FFFFFF"
    圆角: 5
    
    点击 => 提交表单()
}
```

### 4.3 文本框

```御程
文本框 用户名输入 {
    提示文字: "请输入用户名"
    宽度: 200
    最大长度: 20
    
    绑定: 用户名变量
    输入 => 验证用户名()
    回车 => 提交()
}
```

### 4.4 密码框

```御程
密码框 密码输入 {
    提示文字: "请输入密码"
    宽度: 200
    显示切换按钮: 真
    
    绑定: 密码变量
}
```

### 4.5 复选框

```御程
复选框 同意条款 {
    文字: "我已阅读并同意用户协议"
    选中: 假
    
    绑定: 已同意变量
    变化 => 更新按钮状态()
}
```

### 4.6 下拉选择

```御程
下拉选择 城市选择 {
    选项: ["北京", "上海", "广州", "深圳"]
    默认: "北京"
    可搜索: 真
    
    绑定: 城市变量
    变化 => 加载区县()
}
```

### 4.7 列表

```御程
列表 用户列表 {
    数据源: 用户数组
    
    项模板 {
        布局_水平 {
            图片 { 源: 项.头像 宽度: 40 }
            文本标签 { 内容: 项.名字 }
        }
    }
    
    点击项 => 查看用户(项)
}
```

### 4.8 表格

```御程
表格 数据表格 {
    数据源: 数据数组
    可排序: 真
    斑马纹: 真
    
    列 { 字段: "id" 标题: "ID" 宽度: 60 }
    列 { 字段: "name" 标题: "姓名" 宽度: 120 }
    列 { 字段: "age" 标题: "年龄" 宽度: 80 }
}
```

## 5. 高级控件

### 5.1 选项卡

```御程
选项卡 主选项卡 {
    选项卡页 {
        标题: "首页"
        文本标签 { 内容: "这是首页" }
    }
    
    选项卡页 {
        标题: "设置"
        文本标签 { 内容: "这是设置页" }
    }
}
```

### 5.2 对话框

```御程
对话框 确认对话框 {
    标题: "确认操作"
    宽度: 400
    
    布局_垂直 {
        文本标签 { 内容: "确定要执行此操作吗？" }
        
        布局_水平 {
            按钮 { 文字: "取消" 点击 => 关闭对话框() }
            按钮 { 文字: "确定" 点击 => 确认操作() }
        }
    }
}
```

## 6. 数据绑定

### 6.1 单向绑定

```御程
// .yc 文件
var 用户名 = ""

// .ycv 文件
文本标签 显示名 {
    内容: 绑定(用户名)
}
```

### 6.2 双向绑定

```御程
文本框 输入框 {
    绑定: 输入内容  // 自动双向绑定
}
```

### 6.3 条件绑定

```御程
按钮 登录按钮 {
    可见: 绑定(!已登录)
}

按钮 退出按钮 {
    可见: 绑定(已登录)
}
```

## 7. 事件处理

### 7.1 事件类型

| 事件 | 适用控件 | 说明 |
|------|---------|------|
| `点击` | 按钮、图片 | 鼠标点击 |
| `双击` | 列表、表格 | 鼠标双击 |
| `输入` | 文本框 | 内容变化 |
| `回车` | 文本框 | 按下回车 |
| `变化` | 选择类控件 | 选择变化 |
| `获得焦点` | 输入控件 | 获得焦点 |
| `失去焦点` | 输入控件 | 失去焦点 |

### 5.1 事件绑定

```御程
按钮 { 
    点击 => 处理点击()
    悬停 => 显示提示()
}

// 内联处理
按钮 { 
    点击 => {
        计数 += 1
        更新显示()
    }
}
```

## 8. 完整示例：登录界面

### login.ycv (视图)

```御程
窗口 登录窗口 {
    标题: "用户登录"
    宽度: 400
    高度: 350
    可调整: 假
    居中: 真
    
    布局_垂直 {
        内边距: 40
        间距: 16
        对齐: "居中"
        
        图片 { 源: "logo.png" 宽度: 64 高度: 64 }
        
        文本标签 {
            内容: "欢迎登录"
            字体大小: 24
            字体粗细: "粗体"
        }
        
        文本框 {
            提示文字: "请输入用户名"
            宽度: 280
            绑定: 用户名
        }
        
        密码框 {
            提示文字: "请输入密码"
            宽度: 280
            绑定: 密码
            回车 => 登录()
        }
        
        复选框 {
            文字: "记住密码"
            绑定: 记住密码
        }
        
        按钮 {
            文字: "登 录"
            宽度: 280
            高度: 44
            背景色: "#1976D2"
            文字颜色: "#FFFFFF"
            禁用: 绑定(登录中)
            点击 => 登录()
        }
        
        文本标签 {
            内容: 绑定(错误信息)
            字体颜色: "#F44336"
            可见: 绑定(错误信息 <> "")
        }
    }
}
```

### login.yc (规格)

```御程
var 用户名: 文本 = ""
var 密码: 文本 = ""
var 记住密码: 布尔 = 假
var 登录中: 布尔 = 假
var 错误信息: 文本 = ""

副作用 func 登录()
查询 func 验证输入() -> 布尔
```

### login.yci (实现)

```御程
副作用 func 登录() {
    错误信息 = ""
    
    如果 !验证输入() {
        返回
    }
    
    登录中 = 真
    
    尝试 {
        var 响应 = HTTP_POST("https://api.example.com/login", {
            "username": 用户名,
            "password": 密码
        })
        
        如果 响应.成功 {
            跳转主页()
        } 否则 {
            错误信息 = 响应.错误信息
        }
    } 捕获 错误 {
        错误信息 = "网络错误"
    } 最终 {
        登录中 = 假
    }
}

查询 func 验证输入() -> 布尔 {
    如果 用户名 == "" {
        错误信息 = "请输入用户名"
        返回 假
    }
    如果 密码 == "" {
        错误信息 = "请输入密码"
        返回 假
    }
    返回 真
}
```

### login.ycl (链接)

```json
{
  "项目名称": "登录应用",
  "模块链接": [
    {
      "规格": "login.yc",
      "实现": "login.yci",
      "视图": "login.ycv"
    }
  ],
  "入口窗口": "登录窗口"
}
```
