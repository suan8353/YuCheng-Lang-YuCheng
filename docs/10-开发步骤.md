# YuCheng 语言 - 开发步骤

## MVP 定义（最小可行产品）

> **YuCheng MVP = CLI 编译器 + JSON 输出**

### MVP 验收标准

```bash
# 1. 能编译运行 Hello World
yucheng run hello.ycs
# 输出: 你好，世界！

# 2. 能检查规格-实现匹配
yucheng check project.ycl
# 输出: JSON 格式的检查结果

# 3. 能运行测试
yucheng test project.ycs
# 输出: JSON 格式的测试报告

# 4. 能生成内存观察报告
yucheng run --memory-report program.ycs
# 输出: JSON 格式的内存观察报告
```

### MVP 范围

| 组件 | 状态 | 必要性 |
|------|------|--------|
| 词法/语法分析器 | ✅ | 必须 |
| 类型检查器 | ✅ | 必须 |
| 解释器 | ✅ | 必须 |
| 标准库 | ✅ | 必须 |
| 链接检查器 | ✅ | 必须 |
| JSON 输出 | ✅ | 必须 |
| CLI 工具 | ✅ | 必须 |
| IDE | ✅ | 可选（消费 JSON 的前端）|
| 安装器 | ⏳ | 可选（分发便利性）|

---

## 总体路线图

```
Phase 1: 核心编译器 (MVP)     ✅ 已完成
    ↓
Phase 2: 标准库              ✅ 已完成
    ↓
Phase 3: IDE 基础版          ✅ 已完成
    ↓
Phase 4: 内存透视系统         ✅ 已完成
    ↓
Phase 5: 界面系统            ✅ 已完成
    ↓
Phase 6: 测试框架            ✅ 已完成
    ↓
Phase 7: 多语言互操作         ✅ 已完成
    ↓
Phase 8: 安装器系统          ✅ 已完成
    ↓
Phase 9: IDE 智能检查系统     ✅ 已完成
    ↓
Phase 10: 友好错误系统        ✅ 已完成
    ↓
Phase 11: 完善与优化          ⏳ 持续
```

---

## Phase 1: 核心编译器 (MVP) ✅ 已完成

**目标**: 实现最小可用编译器，能编译运行简单程序

### 1.1 符号预处理器 ✅

- [x] 实现字符映射表
- [x] 全角到半角转换
- [x] 字符串内部不转换
- [x] 单元测试

### 1.2 词法分析器 ✅

- [x] Token 枚举定义
- [x] 关键字识别 (如果、否则、循环、var、func)
- [x] 运算符识别 (=、=>、<=、==、<>)
- [x] 字面量识别
- [x] 中文标识符支持
- [x] 中英文关键字双语支持

### 1.3 语法分析器 ✅

- [x] AST 节点定义
- [x] 变量声明解析
- [x] 函数声明/实现解析
- [x] 表达式解析
- [x] 控制流解析

### 1.4 链接检查器 ✅

- [x] 解析 .yc 提取声明
- [x] 解析 .yci 提取实现
- [x] 声明-实现匹配检查
- [x] 错误报告生成

### 1.5 解释器 ✅

- [x] 树遍历解释器（`interpreter.rs`，8184行代码）
- [x] 变量存储和查找（作用域栈、内联缓存）
- [x] 函数调用（支持函数重载、尾调用优化）
- [x] 基本运算（算术、逻辑、比较）
- [x] 控制流（if/while/for/match）
- [x] 控制台 I/O
- [x] 输出缓冲区（用于IDE集成）
- [x] 异步支持（集成 Tokio 运行时）
- [x] 内存透视集成（可选）
- [x] 调试器集成（可选）
- [x] 执行追踪（可选）

**里程碑 M1**: ✅ Hello World 可运行

---

## Phase 2: 标准库 ✅ 已完成

### 2.1 核心函数 ✅

- [x] 打印（副作用）
- [x] 输入（副作用）
- [x] 类型转换函数（纯函数）

### 2.2 数学函数 ✅

- [x] 绝对值、四舍五入（纯函数）
- [x] 最大值、最小值（纯函数）
- [x] 随机整数（副作用）
- [x] 三角函数、对数等

### 2.3 文本函数 ✅

- [x] 文本长度、文本拼接（纯函数）
- [x] 文本截取、文本替换（纯函数）
- [x] 文本包含、文本分割（查询）

### 2.4 集合函数 ✅

- [x] 列表操作（添加、获取、长度等）
- [x] 映射操作

### 2.5 时间函数 ✅

- [x] 当前时间（查询）
- [x] 时间格式化

**里程碑 M2**: ✅ 标准库基本可用（30+ 函数）

---

## Phase 3: IDE 基础版 ✅ 已完成

### 3.1 项目搭建 ✅

- [x] Tauri + Vue 项目初始化
- [x] 集成编译器核心
- [x] 基础窗口布局

### 3.2 代码编辑器 ✅

- [x] Monaco Editor 集成
- [x] YuCheng 语法高亮
- [x] 基础自动补全
- [x] 错误标注（红色波浪线）

### 3.3 文件管理 ✅

- [x] 文件树组件
- [x] 文件打开/保存
- [x] 多标签页
- [x] 错误文件红色标记

### 3.4 运行与调试 ✅

- [x] 运行按钮（仅 .ycs/.yci 可运行）
- [x] 控制台输出面板
- [x] 错误跳转
- [x] 问题面板

### 3.5 快捷键 ✅

- [x] Ctrl+N 新建文件
- [x] Ctrl+O 打开文件
- [x] Ctrl+S 保存文件
- [x] Ctrl+W 关闭标签
- [x] F5 运行代码
- [x] Ctrl+Shift+B 检查代码

### 3.6 打包发布 ✅

- [x] Windows 打包 (MSI/NSIS)
- [ ] macOS 打包（待测试）
- [ ] Linux 打包（待测试）

**里程碑 M3**: ✅ IDE 基础版发布

---

## Phase 4: 内存透视系统 ✅ 已完成

### 4.1 内存模拟器 ✅

- [x] 栈帧管理
- [x] 堆内存模拟
- [x] 指针跟踪
- [x] 内存快照生成
- [x] 问题检测（泄漏、双重释放、悬空指针）

### 4.2 JSON 报告 ✅

- [x] 报告 Schema 定义
- [x] 快照序列化
- [x] 问题报告生成

### 4.3 图表组件 ✅

- [x] 内存使用条形图
- [x] 统计卡片显示
- [x] 问题列表可视化
- [x] 健康状态指示

### 4.4 IDE 集成 ✅

- [x] 透视运行按钮
- [x] 控制台报告输出
- [x] 内存面板组件 (MemoryPanel.vue)
- [x] 问题列表与跳转

**里程碑 M4**: ✅ 内存透视可用

---

## Phase 5: 界面系统 ✅ 已完成

### 5.1 .ycv 解析器 ✅

- [x] 语法定义
- [x] 词法/语法分析
- [x] UI AST 生成

### 5.2 布局系统 ✅

- [x] 垂直/水平布局
- [x] 网格布局
- [x] 滚动布局

### 5.3 基础控件 ✅

- [x] 文本标签、按钮
- [x] 文本框、密码框
- [x] 复选框、下拉选择
- [x] 图片

### 5.4 高级控件 ✅

- [x] 列表 (ListView)
- [x] 表格 (Table)
- [x] 选项卡 (TabView)
- [x] 对话框 (Dialog)
- [x] 进度条 (ProgressBar)
- [x] 滑块 (Slider)

### 5.5 数据绑定 ✅

- [x] 单向/双向绑定
- [x] 条件绑定

### 5.6 渲染引擎 ✅

- [x] HTML/CSS 渲染
- [x] 事件处理
- [x] 样式系统

### 5.7 IDE 集成 ✅

- [x] .ycv 文件预览
- [x] 预览按钮（仅 .ycv 文件显示）
- [x] UiPreview 组件集成
- [ ] 可视化编辑器（未来版本）

**里程碑 M5**: ✅ GUI 程序可构建

---

## Phase 6: 测试框架 ✅ 已完成

### 6.1 基础断言函数 ✅

- [x] 断言_相等、断言_不等
- [x] 断言_为真、断言_为假
- [x] 断言_为空、断言_非空
- [x] 断言_大于、断言_小于
- [x] 断言_范围内
- [x] 断言_近似相等
- [x] 断言_包含、断言_不包含
- [x] 断言_长度
- [x] 断言_为空集合、断言_非空集合
- [x] 断言_类型

### 6.2 御程独有断言函数 ✅

- [x] 断言_成功、断言_失败（结果类型验证）
- [x] 断言_成功值、断言_失败值（结果值验证）
- [x] 断言_全部成功、断言_任一成功（批量结果验证）
- [x] 断言_匹配（模式匹配，支持 * 和 ? 通配符）
- [x] 断言_有序（列表排序验证，支持升序/降序）
- [x] 断言_唯一（元素唯一性验证）
- [x] 断言_子集（子集关系验证）
- [x] 断言_深度相等（递归深度比较）
- [x] 断言_变换（管道操作结果验证）
- [x] 断言_管道、断言_管道链（管道专用断言）
- [x] 断言_耗时（性能时间验证）
- [x] 断言_内存、断言_无泄漏（内存使用验证）
- [x] 断言_快照、更新_快照（快照测试）
- [x] 断言_纯函数、断言_幂等、断言_无副作用（函数分类验证）

### 6.3 测试运行器 ✅

- [x] TestRunner 结构
- [x] TestReport 报告生成
- [x] JSON 格式输出
- [x] 控制台格式输出

### 6.4 测试模块 ✅

- [x] testing.rs 模块
- [x] 标准库集成（40 个断言函数）
- [x] 107 个单元测试
- [x] 64 个集成测试

**里程碑 M6**: ✅ 测试框架可用（共 258 个测试全部通过）

---

## Phase 7: 多语言互操作 ⏳ 进行中

### 7.1 FFI 基础设施 ✅

- [x] `ffi.rs` 模块创建
- [x] C ABI 类型映射
- [x] 导出函数注册表
- [x] 函数签名转换

### 7.2 代码生成 ✅

- [x] C 头文件生成器
- [x] Python ctypes 绑定生成
- [x] Go cgo 绑定生成
- [x] Rust FFI 绑定生成

### 7.3 运行时桥接 ✅

- [x] 字符串转换 (YuCheng ↔ C)
- [x] 值类型转换 (Value ↔ CValue)
- [x] 外部库注册表
- [x] 模拟外部函数调用

### 7.4 调用外部库 ✅

- [x] `外部` 关键字定义
- [x] `库` 关键字定义
- [x] ExternalLibrary 结构
- [x] ExternalRegistry 管理器
- [x] 模拟调用（sin, cos, sqrt, pow, strlen）

### 7.5 测试 ✅

- [x] FFI 单元测试 (14 个)
- [x] External 单元测试 (6 个)
- [x] FFI 集成测试 (39 个)

**里程碑 M7**: ✅ 多语言互操作基础完成（支持12种语言互操作）

---

## Phase 8: 安装器系统 ✅ 已完成

### 8.1 模块化架构 ✅

- [x] 核心引擎组件定义 (core.json)
- [x] Python SDK 组件定义 (python-sdk.json)
- [x] Go SDK 组件定义 (go-sdk.json)
- [x] C++ 运行时组件定义 (cpp-runtime.json)
- [x] Rust SDK 组件定义 (rust-sdk.json)

### 8.2 安装向导 ✅

- [x] NSIS 主安装脚本 (yucheng-setup.nsi)
- [x] 组件定义头文件 (components.nsh)
- [x] 工作负载选择界面（VS2019 风格）
- [x] 组件勾选与大小显示
- [x] 安装路径选择
- [x] 文件关联注册

### 8.3 构建脚本 ✅

- [x] Windows 构建脚本 (build-installer.ps1)
- [x] 组件打包脚本 (package-components.ps1)
- [x] 校验和生成

### 8.4 SDK 管理器 ✅

- [x] sdk_manager.rs 模块
- [x] 组件扫描与检测
- [x] 配置文件读写 (TOML)
- [x] 启用/禁用组件
- [x] 状态报告生成
- [x] 4 个单元测试

### 8.5 环境隔离 ✅

- [x] 私有 SDK 目录设计 (`$INSTDIR\SDKs\`)
- [x] 自动路径配置
- [x] 环境变量设置

### 8.6 在线组件管理 ✅

- [x] 在线组件下载器
  - [x] `fetch_remote_components()` 远程组件列表获取
  - [x] `start_download()` 下载启动
  - [x] `simulate_download_progress()` 进度模拟
  - [x] `complete_install()` 安装完成处理
- [x] 组件更新检测
  - [x] `check_all_updates()` 批量更新检查
  - [x] `check_update()` 单组件更新检查
  - [x] `compare_versions()` 版本比较
  - [x] `get_updatable()` 获取可更新列表
  - [x] `update_component()` 组件更新
- [x] IDE 集成（组件管理面板）
  - [x] `ComponentPanel.vue` 组件管理界面
  - [x] 已安装/可安装/更新三标签页
  - [x] 下载进度显示
  - [x] 安装/卸载/启用/禁用操作
  - [x] IDE 后端命令集成
  - [x] 工具栏组件按钮

**里程碑 M8**: ✅ 安装器与组件管理系统完成

---

## Phase 9: IDE 智能检查系统 ✅ 已完成

### 9.1 阻塞检查器 ✅

- [x] `blocking_checker.rs` 模块
- [x] 阻塞函数识别（睡眠、I/O、网络、数据库）
- [x] UI 函数阻塞检测
- [x] 检查报告生成
- [x] 7 个单元测试

### 9.2 链路测试框架 ✅

- [x] `chain_test.rs` 模块
- [x] 链路测试用例定义
- [x] Mock 响应系统
- [x] 接口契约验证
- [x] UI 契约验证
- [x] 覆盖率计算
- [x] 5 个单元测试

### 9.3 项目级检查器 ✅

- [x] `project_checker.rs` 模块
- [x] 多级检查（轻量/标准/严格）
- [x] 契约文件检查
- [x] 实现文件检查
- [x] 测试文件检查
- [x] 链路一致性检查
- [x] 6 个单元测试

### 9.4 IDE 集成 ✅

- [x] 高级检查按钮
- [x] 问题面板（分类展示）
- [x] Tauri 命令集成
- [x] 检查级别选择

**里程碑 M9**: ✅ IDE 智能检查系统完成

---

## Phase 10: 友好错误系统 ✅ 已完成

### 10.1 错误模式匹配器 ✅

- [x] `friendly_errors.rs` 模块
- [x] ErrorPatternMatcher 结构
- [x] 空值错误转换
- [x] 类型错误转换
- [x] 除零错误转换
- [x] 索引错误转换
- [x] 契约错误转换
- [x] 状态错误转换
- [x] 5 个单元测试

### 10.2 即时检查器 ✅

- [x] InstantChecker 结构
- [x] 空值访问检查
- [x] 除零风险检查
- [x] 索引越界检查
- [x] 错误处理检查
- [x] 状态处理检查
- [x] 契约建议
- [x] 6 个单元测试

### 10.3 IDE 集成 ✅

- [x] FriendlyErrorPanel.vue 组件
- [x] 智能检查按钮
- [x] 实时检查（500ms 防抖）
- [x] 一键修复建议
- [x] Tauri 命令集成

**里程碑 M10**: ✅ 友好错误系统完成

---

## 里程碑总览

| 里程碑 | 目标 | 状态 |
|--------|------|------|
| M1 | Hello World 可运行 | ✅ 已完成 |
| M2 | 标准库基本可用 | ✅ 已完成 |
| M3 | IDE 基础版发布 | ✅ 已完成 |
| M5 | GUI 程序可构建 | ✅ 已完成 |
| M6 | 测试框架可用 | ✅ 已完成 |
| M7 | 多语言互操作可用 | ✅ 已完成 |
| M8 | 安装即用，无需配置 | ✅ 已完成 |
| M9 | IDE 智能检查系统 | ✅ 已完成 |
| M10 | 友好错误系统 | ✅ 已完成 |
| M11 | **1.0 正式版发布** | ⏳ 待开始 |

---

## 快速开始

```bash
# 克隆项目
git clone https://github.com/your-org/yucheng-lang.git
cd yucheng-lang

# 编译器开发
cd compiler
cargo build
cargo test

# IDE 开发
cd ../ide
npm install
npm run tauri dev

# 构建发布版
npm run tauri build

# 运行示例
cd ../compiler
cargo run -- run ../examples/simple-test.ycs
```

---

## 已完成的文件结构

```
YuCheng-Lang/
├── compiler/                 # Rust 编译器
│   ├── src/
│   │   ├── main.rs          # CLI 入口
│   │   ├── lib.rs           # 库导出
│   │   ├── preprocessor.rs  # 预处理器
│   │   ├── lexer.rs         # 词法分析
│   │   ├── token.rs         # Token 定义
│   │   ├── keywords.rs      # 关键字映射（中英文）
│   │   ├── parser.rs        # 语法分析
│   │   ├── ast.rs           # AST 定义
│   │   ├── analyzer.rs      # 语义分析器
│   │   ├── semantic.rs      # 语义分析（编译期检查）
│   │   ├── linker.rs        # 链接检查
│   │   ├── interpreter.rs   # 树遍历解释器（8184行）
│   │   ├── bytecode.rs      # 字节码编译器和VM
│   │   ├── llvm_backend.rs  # LLVM 后端
│   │   ├── wasm_backend.rs  # WebAssembly 后端
│   │   ├── compiler.rs      # 统一编译驱动器
│   │   ├── stdlib.rs        # 标准库
│   │   ├── memory.rs        # 内存模拟器
│   │   ├── testing.rs       # 测试框架
│   │   ├── ffi.rs           # FFI 管理器
│   │   ├── external.rs      # 外部库调用
│   │   ├── python_interop.rs # Python 互操作
│   │   ├── lang_interop.rs  # 多语言互操作（12种）
│   │   ├── ui/              # UI 系统
│   │   ├── layers/          # 分层架构
│   │   └── ...              # 其他100+模块
│   └── tests/               # 测试文件（625+测试）
│
├── ide/                      # Tauri IDE
│   ├── src/
│   │   ├── App.vue          # 主应用
│   │   └── components/
│   │       ├── Editor.vue   # Monaco 编辑器
│   │       ├── FileTree.vue # 文件树
│   │       ├── TabBar.vue   # 标签栏
│   │       ├── Console.vue  # 控制台
│   │       ├── Toolbar.vue  # 工具栏
│   │       ├── StatusBar.vue# 状态栏
│   │       ├── MemoryPanel.vue # 内存透视面板
│   │       └── UiPreview.vue   # UI 预览面板
│   └── src-tauri/
│       └── src/lib.rs       # Tauri 后端
│
├── docs/                     # 文档
│   ├── 01-架构文档.md
│   ├── 02-开发文档.md
│   ├── ...
│   └── 19-国际化设计.md
│
└── examples/                 # 示例代码
    ├── hello-single/
    ├── calculator/
    ├── todo-app/
    └── ...
```

---

## 开发建议

1. **先跑通，再优化**: MVP 阶段不追求完美
2. **测试驱动**: 每个模块都要有测试
3. **文档同步**: 代码和文档同步更新
4. **每周检查**: 定期进度检查
