# YuCheng 语言 (御程) - 项目总览

> **版本**: 0.1.0 (MVP)  
> **状态**: 开发中  
> **测试覆盖**: 664个测试 (662通过/2失败, 99.7%)

---

## 一、项目简介

YuCheng（御程）是一门面向 AI 时代的中文编程语言，专为"小白能看懂"且"AI 能高效用"而设计。

### 核心特色

| 特色 | 说明 |
|------|------|
| **四文件强制闭环** | `.yc`(规格) + `.yci`(实现) + `.ycl`(链接) + `.ycv`(视图)，编译器强制验证 |
| **函数分类系统** | `纯函数`/`查询`/`副作用` 三分类，编译器强制约束调用关系 |
| **内存透视系统** | 实时观察内存状态，生成 JSON 报告供 AI 分析 |
| **中英文双语** | 所有关键字支持中英文两种写法 |
| **契约编程** | `要求`/`保证` 前后置条件，支持契约等级 |
| **安全边界明确** | 明确区分安全代码和 `不安全` 块 |

### 设计原则

```
透明 > 魔法    —— 所有行为可观察、可审计
诚实 > 承诺    —— 明确说明保证什么、不保证什么
务实 > 完美    —— 先做能做的，再扩展边界
```

---

## 二、项目结构

```
YuCheng-Lang/
├── compiler/                 # Rust 编译器 (核心)
│   ├── src/
│   │   ├── lib.rs           # 库导出
│   │   ├── main.rs          # CLI 入口
│   │   ├── preprocessor.rs  # 符号预处理（全角→半角）
│   │   ├── lexer.rs         # 词法分析器
│   │   ├── token.rs         # Token 定义
│   │   ├── keywords.rs      # 关键字映射（中英文）
│   │   ├── parser.rs        # 语法分析器
│   │   ├── ast.rs           # 抽象语法树
│   │   ├── linker.rs        # 链接检查器
│   │   ├── interpreter.rs   # 树遍历解释器
│   │   ├── stdlib.rs        # 标准库（30+ 函数）
│   │   ├── memory.rs        # 内存模拟器（观察工具）
│   │   ├── testing.rs       # 测试框架（40 断言函数）
│   │   ├── ffi.rs           # FFI 管理器
│   │   ├── external.rs      # 外部库调用
│   │   ├── lang_interop.rs  # 多语言互操作 (12种)
│   │   ├── bubble_tutorial.rs # 气泡教程系统
│   │   ├── ai_assistant.rs  # AI 编程助手
│   │   ├── ai_rules.rs      # AI 规则引擎
│   │   ├── sdk_manager.rs   # SDK 组件管理
│   │   ├── blocking_checker.rs # 阻塞检查器
│   │   ├── chain_test.rs    # 链路测试框架
│   │   ├── project_checker.rs # 项目级检查器
│   │   ├── friendly_errors.rs # 友好错误系统
│   │   ├── ui_testing.rs    # UI 测试框架
│   │   ├── compiler.rs      # 统一编译驱动器（多后端）
│   │   ├── system_api.rs    # 系统 API（跨平台）
│   │   ├── layers/          # 分层架构模块
│   │   │   ├── foundation.rs   # 基础层
│   │   │   ├── compilation.rs  # 编译层
│   │   │   ├── domain.rs       # 领域层
│   │   │   ├── service.rs      # 服务层
│   │   │   └── application.rs  # 应用层
│   │   ├── ui/              # UI 系统
│   │   │   ├── lexer.rs     # UI 词法分析
│   │   │   ├── parser.rs    # UI 语法分析
│   │   │   ├── ast.rs       # UI AST
│   │   │   └── renderer.rs  # HTML 渲染器
│   │   ├── error.rs         # 错误类型（含阶段分类）
│   │   └── span.rs          # 源码位置
│   └── tests/               # 511 个测试
│       ├── comprehensive_test.rs      # 综合测试 (37)
│       ├── advanced_syntax_test.rs    # 高级语法测试 (13)
│       ├── unique_syntax_test.rs      # 御程特有语法测试 (16)
│       ├── testing_framework_test.rs  # 测试框架测试 (64)
│       ├── ui_test.rs                 # UI 系统测试 (21)
│       ├── ui_features_test.rs        # UI 功能测试 (23)
│       ├── ffi_test.rs                # FFI 测试 (39)
│       └── safety_boundary_test.rs    # 安全边界测试 (11)
│       # 单元测试 (lib.rs) 包含 200 个测试
│
├── ide/                      # Tauri + Vue IDE
│   ├── src/
│   │   ├── App.vue          # 主应用
│   │   └── components/
│   │       ├── Editor.vue       # Monaco 编辑器
│   │       ├── FileTree.vue     # 文件树
│   │       ├── TabBar.vue       # 标签栏
│   │       ├── Console.vue      # 控制台
│   │       ├── MemoryPanel.vue  # 内存透视面板
│   │       ├── UiPreview.vue    # UI 预览
│   │       ├── TestPanel.vue    # 测试面板
│   │       ├── BuildPanel.vue   # 构建面板
│   │       ├── ComponentPanel.vue # 组件管理面板
│   │       ├── ProblemsPanel.vue  # 问题面板
│   │       └── FriendlyErrorPanel.vue # 友好错误面板
│   └── src-tauri/
│       └── src/lib.rs       # Tauri 后端
│
├── installer/                # 安装器系统
│   ├── nsis/                # NSIS 脚本
│   ├── components/          # 组件定义 JSON
│   └── scripts/             # 构建脚本
│
├── docs/                     # 文档 (34 篇)
│   ├── 00-项目总览.md       # 本文档
│   ├── 01-架构文档.md
│   ├── ...
│   ├── 25-端到端链路测试系统.md
│   ├── 26-IDE增强与智能检查系统.md
│   ├── 27-代码转换器设计.md
│   └── 28-痛点解决方案总结.md
│
└── examples/                 # 示例代码
    ├── hello-single/        # 单文件示例
    ├── calculator/          # 计算器
    ├── login-app/           # 登录应用（含 UI）
    ├── todo-app/            # 待办事项
    ├── ffi-demo/            # FFI 示例
    └── ...
```

---

## 三、已实现功能

### 3.1 编译器核心 ✅

| 模块 | 功能 | 测试数 |
|------|------|--------|
| 预处理器 | 全角符号转半角、中文引号处理 | 8 |
| 词法分析器 | 中英文关键字、运算符、字面量 | 10 |
| 语法分析器 | 完整 AST、契约、不安全块 | 5 |
| 链接检查器 | .yc ↔ .yci 匹配验证 | 2 |
| 解释器 | 树遍历执行、函数调用、控制流 | 6 |
| 错误系统 | 编译时/运行时错误分类 | 3 |

### 3.2 语言特性 ✅

| 特性 | 中文语法 | 英文语法 |
|------|----------|----------|
| 纯函数 | `纯函数 func` | `pure func` |
| 查询函数 | `查询 func` | `query func` |
| 副作用函数 | `副作用 func` | `effect func` |
| 异步函数 | `异步 func` | `async func` |
| 不安全函数 | `不安全 副作用 func` | `unsafe effect func` |
| 条件判断 | `如果`/`否则`/`否则如果` | `if`/`else`/`elif` |
| 循环 | `循环`/`当` | `for`/`while` |
| 匹配 | `匹配` | `match` |
| 契约 | `要求`/`保证` | `requires`/`ensures` |
| 不安全块 | `不安全 { }` | `unsafe { }` |

### 3.3 御程特有语法 ✅

```御程
// 管道操作符
var 结果 = 数据 |> 过滤(是偶数) |> 映射(平方) |> 求和()

// 空值合并
var 名字 = 用户名 ?? "匿名"

// 安全访问
var 城市 = 用户?.地址?.城市

// 包含范围
循环 i 在 1...5 { }    // 1,2,3,4,5

// 步长范围
循环 i 在 0..100 步进 2 { }

// 条件表达式
var 状态 = 若 分数 >= 60 则 "及格" 否则 "不及格"

// 选择表达式
var 等级 = 选择 {
    分数 >= 90 => "优秀"
    分数 >= 80 => "良好"
    其他 => "一般"
}
```

### 3.4 标准库 ✅ (30+ 函数)

| 分类 | 函数 |
|------|------|
| 数学 | `绝对值`, `四舍五入`, `最大值`, `最小值`, `随机整数`, `正弦`, `余弦`, `平方根` |
| 文本 | `长度`, `截取`, `替换`, `分割`, `包含`, `大写`, `小写`, `去空格` |
| 列表 | `添加`, `获取`, `长度`, `映射`, `过滤`, `排序`, `反转` |
| 类型 | `转整数()`, `转小数()`, `转文本()`, `转布尔()`, `获取类型()` |
| I/O | `打印`, `输入`, `读取文件`, `写入文件`, `追加文件`, `删除文件` |
| 日志 | `追踪`, `调试`, `信息`, `日志`, `警告`, `错误日志` |
| 系统 | `获取环境变量`, `执行命令`, `当前时间戳`, `获取操作系统`, `获取用户名` |

### 3.5 测试框架 ✅ (40 断言函数)

| 分类 | 断言函数 |
|------|----------|
| 基础 | `断言_相等`, `断言_不等`, `断言_为真`, `断言_为假`, `断言_为空`, `断言_非空` |
| 比较 | `断言_大于`, `断言_小于`, `断言_范围内`, `断言_近似相等` |
| 集合 | `断言_包含`, `断言_长度`, `断言_有序`, `断言_唯一`, `断言_子集` |
| 结果类型 | `断言_成功`, `断言_失败`, `断言_成功值`, `断言_失败值` |
| 函数分类 | `断言_纯函数`, `断言_幂等`, `断言_无副作用` |
| 管道 | `断言_管道`, `断言_管道链`, `断言_变换` |
| 性能 | `断言_耗时`, `断言_内存`, `断言_无泄漏` |
| 快照 | `断言_快照`, `更新_快照` |

### 3.6 UI 系统 ✅

| 控件 | 支持 |
|------|------|
| 布局 | 垂直布局、水平布局、网格布局、滚动布局 |
| 基础 | 文本、按钮、文本框、密码框、复选框、下拉选择、图片 |
| 高级 | 列表、表格、选项卡、对话框、进度条、滑块 |
| 绑定 | 单向绑定、双向绑定、条件绑定 |

### 3.7 FFI 系统 ✅

| 功能 | 状态 |
|------|------|
| C 头文件生成 | ✅ |
| Python ctypes 绑定 | ✅ |
| Go cgo 绑定 | ✅ |
| Rust FFI 绑定 | ✅ |
| 外部库声明 (`外部 库`) | ✅ |
| 模拟外部调用 | ✅ |
| 实际动态库加载 | ✅ (libloading) |

### 3.8 内存透视系统 ✅

| 功能 | 说明 |
|------|------|
| 内存模拟器 | 栈帧管理、堆内存模拟、指针跟踪 |
| 问题检测 | 内存泄漏、双重释放、悬空指针、空指针解引用 |
| JSON 报告 | 内存快照、问题列表、执行摘要 |
| IDE 集成 | 内存面板、问题列表、健康状态 |

> **重要**: Memory Simulator 是**观察工具**，不是安全保证。详见 [安全边界文档](21-安全边界与MVP定义.md)。

### 3.9 友好错误系统 ✅

| 功能 | 说明 |
|------|------|
| ErrorPatternMatcher | 将技术错误转换为自然语言解释 |
| InstantChecker | 实时检查代码中的潜在问题 |
| 空值访问检查 | 检测可能的空值访问 |
| 除零风险检查 | 检测可能的除零错误 |
| 索引越界检查 | 检测可能的数组越界 |
| 错误处理检查 | 检测缺少错误处理的操作 |
| 状态处理检查 | 检测不完整的状态处理 |
| 一键修复建议 | 提供可自动应用的修复代码 |

### 3.10 IDE 智能检查系统 ✅

| 功能 | 说明 |
|------|------|
| 阻塞检查器 | 检测 UI 函数中的阻塞调用 |
| 链路测试框架 | 端到端链路测试支持 |
| 项目级检查器 | 全项目静态分析 |
| 高级检查按钮 | 一键执行高级检查 |
| 问题面板 | 分类展示所有问题 |
| 智能检查面板 | 新手友好的错误提示 |

### 3.11 气泡教程系统 ✅

| 功能 | 说明 |
|------|------|
| 气泡类型 | 💡提示、⚠️警告、❌错误、✅成功、📚教程 |
| 技能等级 | 未接触→初学→了解→熟练→精通 |
| 技能类别 | 函数分类、四文件体系、契约系统等8类 |
| 快速修复 | 删除、替换、插入、打开文件、跳转等 |
| 用户画像 | 技能追踪、自动升级、学习进度 |
| 内置教程 | 17个教程（欢迎、纯函数、四文件、契约、内存、测试、UI、异步、类型、错误处理、模块、链路测试、代码转换、多语言互操作、调试、安全边界、性能优化） |
| 上下文帮助 | 17个关键字悬停提示（纯函数、查询、要求、保证、不安全、持有、释放、异步、等待、结果、错误、模块、导入、导出、外部、契约、测试） |
| 帮助中心 | 教程列表、已关闭提示、学习进度报告 |



### 3.12 AI 编程辅助系统 ⚠️（基础框架已实现，核心能力持续完善）

| 功能 | 说明 |
|------|------|
| YuCheng 规则引擎 | 为 AI 提供语言规则约束，确保生成代码符合规范 |
| 结构化 Prompt 模板 | 需求解析、函数填充、错误修复三类模板 |
| AI 生成流水线 | 四阶段流程：需求解析→骨架生成→函数填充→编译验证 |
| 骨架生成器 | 从 JSON Spec 生成 .yc/.yci/.ycl/.ycv 文件 |
| AI 填充引擎 | 仅填充 AI_FILL 占位符，不触碰结构 |
| 函数分类约束 | 纯函数禁止 I/O，查询禁止修改，编译器验证 |
| CLI 命令 | `yucheng ai "需求"` 和 `yucheng scaffold spec.json` |
| IDE 面板 | AI 助手面板，支持自然语言生成代码 |
| 模拟填充 | 15+ 常见函数的模拟实现（无需 API） |

**核心原则**: AI 只填空，你控结构；编译器是最终裁判

### 3.13 系统 API ✅ (28 个函数)

| 分类 | 函数 |
|------|------|
| 文件系统 | `读取文件`, `写入文件`, `追加文件`, `删除文件`, `文件存在`, `列出目录`, `创建目录`, `删除目录`, `获取文件大小`, `是目录`, `是文件` |
| 环境进程 | `获取环境变量`, `设置环境变量`, `获取当前目录`, `执行命令`, `执行命令获取输出`, `获取进程ID`, `获取命令行参数` |
| 时间日期 | `当前时间戳`, `当前日期时间`, `休眠` |
| 系统信息 | `获取操作系统`, `获取CPU架构`, `获取主机名`, `获取用户名`, `获取主目录`, `获取临时目录` |
| 网络 | `HTTP获取` |

**特性**: 跨平台支持（Windows/macOS/Linux），权限控制模型，沙箱模式

### 3.14 多后端编译架构 ✅

| 后端 | 状态 | 说明 |
|------|------|------|
| TreeWalk | ✅ 完成 | 树遍历解释器（当前默认），直接遍历 AST 执行，启动快，适合开发调试 |
| Bytecode VM | ✅ 完成 | 字节码虚拟机，将 AST 编译为字节码后执行，性能更高，适合生产环境 |
| LLVM | ✅ 完成 | LLVM IR 编译，支持生成原生可执行文件（.exe/.out），详见 `llvm21_backend.rs` |
| WebAssembly | ✅ 完成 | Wasm 编译，支持生成 WebAssembly 模块，详见 `wasm_backend.rs` |

**统一编译驱动器**: `compiler.rs` 提供统一的 `Compiler` 接口，支持多后端切换

**执行引擎对比**:
- **树遍历解释器** (`interpreter.rs`): 实现简单，启动快，支持函数重载、尾调用优化、内联缓存、异步执行等特性
- **字节码虚拟机** (`bytecode.rs`): 性能更高，通过字节码中间表示提升执行效率，详见 [字节码虚拟机文档](68-字节码虚拟机.md)

### 3.15 分层架构 ✅

| 层级 | 模块 | 职责 |
|------|------|------|
| 基础层 | `foundation.rs` | 核心 trait、工厂、工具 |
| 编译层 | `compilation.rs` | 编译上下文、流水线 |
| 领域层 | `domain.rs` | 执行引擎、测试运行器 |
| 服务层 | `service.rs` | 格式化、转换、教程服务 |
| 应用层 | `application.rs` | 编译器应用、IDE 接口 |

---

## 四、安全边界

### 4.1 我们保证什么

| 层级 | 保证内容 | 实现方式 |
|------|----------|----------|
| 语言层 | 作用域绑定、类型安全、函数分类约束 | 编译器强制 |
| 运行时 | 数组边界检查、空值访问防护 | 运行时检查 |

### 4.2 我们不保证什么

- ❌ 不承诺"100% 内存安全"
- ❌ 不承诺 FFI 调用的安全性
- ❌ 不承诺 `不安全` 块内的行为
- ❌ 不承诺外部库的正确性

### 4.3 责任划分

```
┌─────────────────────────────────────────────────────────┐
│                    语言层（编译器保证）                   │
├─────────────────────────────────────────────────────────┤
│                    运行时层（动态检查）                   │
├─────────────────────────────────────────────────────────┤
│                    观察层（Memory Simulator）            │
│                    报告问题，但不阻止执行                 │
├─────────────────────────────────────────────────────────┤
│                    不安全区（用户责任）                   │
│                    不安全 { } 块、FFI 调用               │
└─────────────────────────────────────────────────────────┘
```

---

## 五、开发进度

| 阶段 | 内容 | 状态 |
|------|------|------|
| Phase 1 | 核心编译器 (MVP) | ✅ 完成 |
| Phase 2 | 标准库 | ✅ 完成 |
| Phase 3 | IDE 基础版 | ✅ 完成 |
| Phase 4 | 内存透视系统 | ✅ 完成 |
| Phase 5 | 界面系统 | ✅ 完成 |
| Phase 6 | 测试框架 | ✅ 完成 |
| Phase 7 | 多语言互操作 | ✅ 完成 |
| Phase 8 | 安装器系统 | ✅ 完成 |
| Phase 9 | IDE 智能检查系统 | ✅ 完成 |
| Phase 10 | 友好错误系统 | ✅ 完成 |
| Phase 11 | 气泡教程系统 | ✅ 完成 |
| Phase 12 | AI 编程辅助系统 | ⚠️ 基础框架完成，核心能力持续完善 |
| Phase 13 | 系统 API 与跨平台支持 | ✅ 完成 |
| Phase 14 | 多后端编译架构 | ✅ 完成 |
| Phase 15 | 分层架构重构 | ✅ 完成 |
| Phase 16 | 完善与优化 | ⏳ 持续 |

### 测试统计

| 测试文件 | 测试数 |
|----------|--------|
| 单元测试 (lib.rs) | 236 |
| 高级特性测试 | 17 |
| 高级语法测试 | 13 |
| 综合测试 | 37 |
| FFI 测试 | 39 |
| 安全边界测试 | 11 |
| 测试语法测试 | 12 |
| 测试框架断言测试 | 64 |
| UI 功能测试 | 23 |
| UI 系统测试 | 21 |
| 御程特有语法测试 | 16 |
| 气泡教程测试 | 16 |
| 代码转换器测试 | 177 |
| AI 助手测试 | 18 |
| 系统 API 测试 | 6 |
| 分层架构测试 | 22 |
| **总计** | **625** |

---

## 六、快速开始

### 6.1 构建编译器

```bash
cd YuCheng-Lang/compiler
cargo build --release
cargo test --all
```

### 6.2 运行示例

```bash
# 运行单文件程序
cargo run -- run ../examples/simple-test.ycs

# 检查代码
cargo run -- check ../examples/calculator/calculator.ycl

# 运行测试
cargo run -- test ../examples/test-example.ycs
```

### 6.3 IDE 开发

```bash
cd YuCheng-Lang/ide
npm install
npm run tauri dev
```

---

## 七、文档索引

| 文档 | 说明 |
|------|------|
| [架构文档](01-架构文档.md) | 系统整体架构设计 |
| [开发文档](02-开发文档.md) | 编译器与 IDE 开发指南 |
| [语法详解](03-语法详解.md) | 完整语法规范 |
| [函数库详解](04-函数库详解.md) | 内置函数分类与用法 |
| [界面系统详解](05-界面系统详解.md) | UI 构建方案 |
| [内存透视详解](06-内存透视详解.md) | 观察工具与 JSON 报告 |
| [测试系统详解](07-测试系统详解.md) | 专用测试函数 |
| [多语言互操作](08-多语言互操作.md) | C ABI 兼容方案 |
| [开发规范](09-开发规范.md) | 编码规范与最佳实践 |
| [开发步骤](10-开发步骤.md) | 从零实现的路线图 |
| [语法总览](20-语法总览.md) | 完整语法参考手册 |
| [安全边界与MVP定义](21-安全边界与MVP定义.md) | 安全保证边界说明 |
| [编译模式与裁剪策略](22-编译模式与裁剪策略.md) | 开发期观察机制的编译时裁剪 |
| [高级类型与测试框架](23-高级类型与测试框架.md) | 高级类型系统与测试框架 |
| [独有UI功能与测试系统](24-独有UI功能与测试系统.md) | 10个独有UI功能及测试函数 |
| [端到端链路测试系统](25-端到端链路测试系统.md) | 前后端一体化链路测试 |
| [IDE增强与智能检查系统](26-IDE增强与智能检查系统.md) | 即时检查、自动检查、阻塞检测 |
| [友好错误系统](29-友好错误系统.md) | 新手友好的错误提示系统 |
| [实现状态检查](30-实现状态检查.md) | 功能实现状态对照表 |
| [测试验收报告](31-测试验收报告.md) | 测试验收结果 |
| [功能实现检查报告](33-功能实现检查报告.md) | 文档与实现对照检查 |
| [AI编程辅助系统](34-AI编程辅助系统.md) | AI 代码生成系统设计 |
| [多后端编译架构](36-多后端编译架构.md) | 多后端编译器设计 |
| [系统API与跨平台支持](37-系统API与跨平台支持.md) | 系统 API 设计与实现 |
| [可视化架构设计系统](72-可视化架构设计系统.md) | 图形化架构设计与AI辅助 |
| [UI设计器系统](73-UI设计器系统.md) | 契约化UI可视化设计 |

---

## 八、编译模式

YuCheng 支持三种编译模式，实现"开发期极致可观察，发布期零开销运行"：

| 模式 | 命令 | 特点 |
|------|------|------|
| **dev** | `yucheng build --mode=dev` | 全部观察机制启用 |
| **test** | `yucheng build --mode=test` | 保留契约和断言 |
| **release** | `yucheng build --mode=release` | 裁剪所有观察机制 |

### 可裁剪机制

| 机制 | dev | test | release |
|------|-----|------|---------|
| 内存透视 | ✅ | ❌ | ❌ |
| 执行追踪 | ✅ | ❌ | ❌ |
| 契约检查 | ✅ | ✅ | ❌ |
| 断言系统 | ✅ | ✅ | ❌ |

> **关键保证**: 裁剪是编译器行为，发布二进制中不存在任何观察代码。

详见 [编译模式与裁剪策略](22-编译模式与裁剪策略.md)。

---

## 九、许可证



---

## 十、联系方式

- GitHub: https://github.com/YuCheng-Lang/YuCheng
- 文档: https://yucheng-lang.github.io/docs

---

*最后更新: 2026-01-14*

---

## 2026-02-22 文档进度同步（代码对齐）

本次已完成 docs 与 compiler/src 的增量对齐，重点修正“已实现能力仍被记为缺失”的偏差。

已完成对齐项：
- Contract `invariant/不变量` 全链路（lexer/parser/semantic/analyzer）
- Contract 条件解析失败不再回退 `true`
- 接口方法签名兼容检查补全（含参数类型兼容）

进度记录文档：
- `SIMPLIFIED-IMPLEMENTATIONS-INVENTORY.md`
- `SIMPLIFIED-IMPLEMENTATIONS-TASK-LIST.md`
- `LANGUAGE_GAP_ANALYSIS.md`

当前状态说明：
- 历史汇总总数（如 110/17/4/7）暂按“历史快照”保留
- 发布前需执行一次全量技术债扫描，统一刷新统计

---

## 2026-02-22 技术债基线刷新（全量重扫）

已完成全量重扫并刷新发布前基线：
- 简化实现：107
- TODO/FIXME（活跃代码）：31
- 暂未实现相关（活跃代码）：12

同时已从“待完成”中剔除已落地能力：
- Contract `invariant/不变量` 全链路
- Contract 解析失败不回退 `true`
- 接口方法签名参数兼容校验

下一阶段默认以该基线跟踪收敛进度。
