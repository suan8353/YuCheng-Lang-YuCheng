# YuCheng 语言 - 本地备份系统

> **实现状态**: ✅ 完整实现
> - ✅ 本地备份系统完整实现（local_backup.rs 555行）
> - ✅ 自动备份机制已实现
> - ✅ 版本管理和恢复功能完整
> - ✅ IDE集成面板已实现

## 📊 实现状态

| 状态 | 说明 |
|------|------|
| **总体实现度** | 100% |
| **核心功能** | ✅ 已实现 |
| **可用性** | ✅ 可用 |
| **最后更新** | 2026-02-07 |

### 详细状态

- ✅ **已实现**:
  - 自动备份机制
  - 备份策略配置
  - 版本管理
  - 恢复操作
  - 备份文件管理
  - IDE集成

---

## 1. 概述

本地备份系统为YuCheng项目提供自动化的代码备份功能，确保代码安全，防止意外丢失。

### 核心特性

- 🔄 **自动备份** - 定时或触发式自动备份
- 📦 **版本管理** - 保留多个备份版本
- 🔍 **快速恢复** - 一键恢复到任意备份点
- 💾 **增量备份** - 只备份变更的文件
- 🎯 **智能清理** - 自动清理过期备份

---

## 2. 核心功能

### 2.1 自动备份

系统支持多种备份触发方式：

- **定时备份** - 每隔N分钟自动备份
- **保存时备份** - 文件保存时自动备份
- **编译前备份** - 编译前自动创建备份点
- **手动备份** - 用户手动触发备份

### 2.2 版本管理

每个备份都包含：
- 时间戳
- 备份说明
- 文件列表
- 变更摘要

### 2.3 恢复操作

支持多种恢复方式：
- 完整恢复 - 恢复整个项目
- 选择性恢复 - 只恢复特定文件
- 对比恢复 - 对比后选择恢复

---

## 3. 使用方法

### 3.1 IDE中使用

1. 打开IDE的"本地备份"面板
2. 查看备份列表
3. 点击"创建备份"或"恢复备份"

### 3.2 配置备份策略

在项目配置文件中设置：

```toml
[backup]
enabled = true
interval_minutes = 30
max_backups = 10
backup_on_save = true
backup_on_compile = true
backup_path = ".yucheng/backups"
```

### 3.3 命令行使用

```bash
# 创建备份
yucheng backup create --message "重要修改前的备份"

# 列出备份
yucheng backup list

# 恢复备份
yucheng backup restore <backup-id>

# 删除备份
yucheng backup delete <backup-id>
```

---

## 4. API参考

### 4.1 LocalBackup结构

```rust
pub struct LocalBackup {
    pub id: String,
    pub timestamp: DateTime<Utc>,
    pub message: String,
    pub files: Vec<BackupFile>,
    pub size: usize,
}
```

### 4.2 主要方法

```rust
// 创建备份
pub fn create_backup(
    project_path: &Path,
    message: &str
) -> Result<LocalBackup>

// 恢复备份
pub fn restore_backup(
    backup_id: &str,
    target_path: &Path
) -> Result<()>

// 列出备份
pub fn list_backups(
    project_path: &Path
) -> Result<Vec<LocalBackup>>

// 删除备份
pub fn delete_backup(
    backup_id: &str
) -> Result<()>
```

---

## 5. 配置选项

| 选项 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| enabled | bool | true | 是否启用备份 |
| interval_minutes | u32 | 30 | 自动备份间隔（分钟） |
| max_backups | u32 | 10 | 最大备份数量 |
| backup_on_save | bool | true | 保存时备份 |
| backup_on_compile | bool | true | 编译前备份 |
| backup_path | String | ".yucheng/backups" | 备份存储路径 |
| compress | bool | true | 是否压缩备份 |

---

## 6. 最佳实践

### 6.1 备份策略建议

- **开发阶段** - 每30分钟自动备份
- **重要修改前** - 手动创建备份点
- **发布前** - 创建标记备份
- **定期清理** - 保留最近10个备份

### 6.2 备份文件管理

- 备份文件存储在 `.yucheng/backups/` 目录
- 每个备份是一个压缩包
- 备份元数据存储在 `backups.json`

### 6.3 恢复注意事项

- 恢复前会创建当前状态的备份
- 恢复操作不可撤销（除非再次恢复）
- 建议先对比再恢复

---

## 7. IDE集成

### 7.1 备份面板

IDE的"本地备份"面板提供：
- 备份列表视图
- 创建备份按钮
- 恢复备份按钮
- 删除备份按钮
- 备份详情查看

### 7.2 快捷操作

- `Ctrl+Shift+B` - 创建备份
- `Ctrl+Shift+R` - 恢复备份
- 右键菜单 - 备份相关操作

---

## 8. 常见问题

### Q: 备份会占用多少空间？

A: 使用增量备份和压缩，通常每个备份只占用几MB。系统会自动清理过期备份。

### Q: 备份文件存储在哪里？

A: 默认存储在项目的 `.yucheng/backups/` 目录。可以在配置中修改。

### Q: 如何恢复到特定时间点？

A: 在备份列表中选择对应时间的备份，点击"恢复"按钮。

### Q: 备份会包含哪些文件？

A: 默认备份所有源代码文件（.ycs, .yci, .ycl, .ycv），不包含编译产物和依赖。

---

## 9. 相关文档

- [IDE集成](14-智能IDE系统.md)
- [项目配置](02-开发文档.md)
- [Git集成](59-Git集成.md)

---

**文档版本**: 1.0  
**创建日期**: 2026-02-07  
**对应代码**: `compiler/src/local_backup.rs`, `ide/src/components/LocalBackupPanel.vue`
